var _base_path="";var _channel_id="000000";var _rsa_modulus="21160827395437480990142284697556218290076113440826700623536503100587136873830433723646829856963206658500123689163169789645100173331809151626315781233070787231663769291811765484940752311778292250831410246697768077237791003524614064511012789884505183671830588497155487687796072979172049301460163616150482611616559039248572972071682139102133845560214413996665595803101688125086744270220570646498961649776967876533461337555376821024071711431990474980065191533741969704968192548589331545597492341432801352066176820308871990997504398716839276783092853825465979449878328086847151877806717213972928227817246386894249591140619";var _rsa_exponent="65537";var _rsa_key="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAp6BER+P7kfN8HDLoQTlPxqIqQHCYFwfMLSryVE0chrINLnKwS2vwgpSHPROjX+zf8SDH/d0plWelWzXIp5fO6ZCN+0VgmxOfnu8/gFWI3BbXfV8XA/temdST6ivMwCq4yhVbshdqgwf6RQ3ahmCBlKFqrIUR8f5dNB9tvdlCUbFPorvD+Va+zNKHhAkXxUvnprJ7c2vcGF4t3OqzU4Mxq19Px4jlKehlssY0fi0FQP9WQc8kdSVcRyeYBcqUbg550XwNiZnRiStNuScVx+FnYPq5jBa/hNsp2QAa+VUJp0xGz8bYe3njS6FRkpyOsIYoMHXBs5cfKDlFsp5vQj1xCwIDAQAB";var _des3_iv="3DESIV00";function signatureMethod(url){}function des3_encrypt(key,text){var keyHex=CryptoJS.enc.Utf8.parse(key);var ivHex=CryptoJS.enc.Utf8.parse(_des3_iv);var encrypted=CryptoJS.TripleDES.encrypt(text,keyHex,{iv:ivHex,mode:CryptoJS.mode.CBC});var ciph=CryptoJS.enc.Hex.stringify(encrypted.ciphertext);return ciph}function des3_decrypt(key,text){var keyHex=CryptoJS.enc.Utf8.parse(key);var ivHex=CryptoJS.enc.Utf8.parse(_des3_iv);var decrypted=CryptoJS.TripleDES.decrypt({ciphertext:CryptoJS.enc.Hex.parse(text)},keyHex,{iv:ivHex,mode:CryptoJS.mode.CBC});var txt=decrypted.toString(CryptoJS.enc.Utf8);return txt}function signatureLogin(rsa,account,password,mode,stamp){var buffer=_channel_id+account+password+mode+stamp+_rsa_modulus+_rsa_exponent;var sign=hex_md5(buffer);var b0=rsa.oencrypt(sign);return b0}function calcSignature2(array){var buffer=_channel_id;for(i=0,len=array.length;i<len;++i){buffer+=array[i]}buffer+=_rsa_modulus+_rsa_exponent;return hex_md5(str2utf8(buffer))}function calcSignature(stamp){var account=localStorage.account;var token=localStorage.accessToken;var random=localStorage.random;var buffer=_channel_id+account+token+stamp+random;return hex_md5(buffer)}function getRootPath_dc(){if(localStorage.rootPath){return localStorage.rootPath}var pathName=window.location.pathname.substring(1);var webName=pathName==""?"":pathName.substring(0,pathName.indexOf("/"));var root;if(webName==""){root=window.location.protocol+"//"+window.location.host+"/"}else{root=window.location.protocol+"//"+window.location.host+"/"+webName+"/"}localStorage.rootPath=root;return root}function getDomain_dc(){if(localStorage.domain){return localStorage.domain}var domain=window.location.protocol+"//"+window.location.host+"/";localStorage.domain=domain;return domain}function $post(url,data,config,sign,stamp0){var stamp=stamp0||(new Date).getTime();var token=localStorage.accessToken;var signature=sign||calcSignature(stamp);var api=getDomain_dc()+url;$.ajax({url:api,data:data,type:"POST",dataType:"json",contentType:"application/json",headers:{Authorization:token,channel:_channel_id,stamp:stamp,signature:signature},success:function(data){if(data.code===0){config.success(data)}else{var showError=false;if(config.failure){config.failure(data.code,data.message)}else{showError=true}if(needLogin(data.code)){localStorage.removeItem("accessToken");localStorage.removeItem("account");localStorage.removeItem("key3");localStorage.removeItem("random");localStorage.removeItem("teacher");clear_data();window.top.location.href=getRootPath_dc()+"login.html"}if(showError){show_code(url,data.code)}}if(config.clear){config.clear()}},error:config.error||function(){show_error(url)}})}function show_error(url){var api=api_map[url];if(api){alert(api+"失败。请重试！")}}function show_code(url,code){url=url.replace("../","");var api=api_map[url];if(!api){api=""}var err="";if(code){err=api_error[code]}else{err=api_error["-1"]}alert(api+"系统提示："+err+"！")}function needLogin(code){return api_need_login.indexOf(code)>-1}function $get(url,data,config,sign,stamp0){return $get(url,data,config,sign,stamp0,true)}function $get(url,data,config,sign,stamp0,async){var stamp=stamp0||(new Date).getTime();var token=localStorage.accessToken;var signature=sign||calcSignature(stamp);var api=getDomain_dc()+url;var _thisWindow=window;$.ajax({url:api,data:data,async:async,type:"GET",dataType:"json",contentType:"application/json",headers:{Authorization:token,channel:_channel_id,stamp:stamp,signature:signature},success:function(data){if(data.code===0){config.success(data)}else{var showError=false;if(config.failure){config.failure(data.code,data.message)}else{showError=true}if(needLogin(data.code)){localStorage.removeItem("accessToken");localStorage.removeItem("account");localStorage.removeItem("key3");localStorage.removeItem("random");localStorage.removeItem("teacher");clear_data();window.top.location.href=getRootPath_dc()+"login.html"}if(showError){show_code(url,data.code)}}if(config.clear){config.clear()}},error:config&&config.error||function(XMLHttpRequest,textStatus){if(_thisWindow==window){show_error(url)}}})}function validate_img(ele){ele=document.getElementById(ele);var file=ele.value;if(!/.(jpg|jpeg|JPG|JPEG)$/.test(file)){ele.value="";alert("图片类型必须是.jpg格式");return false}else{if(ele.files[0].size.toFixed(2)>=200*1024){ele.value="";alert("请上传小于 200Kb 的图片");return false}}return true}function uploadImage(id,config){var path=$("#"+id).val();if(!path){return}else{if(!validate_img(id)){return}var suffix=path.substring(path.lastIndexOf(".")).toLowerCase();var allowedSuffix=config.suffix||".jpg,.jpeg";if(allowedSuffix.indexOf(suffix)<0){alert("请上传后缀为【"+allowedSuffix+"】的图片！");return}else{var url="rest/system/resource/doc/image/upload";if(config.targetId){$upload(url,{targetType:config.targetType,purpose:config.purpose,targetId:config.targetId},{element:id,success:function(data){if(data.length>0){for(var i=0;i<data.length;++i){var document=data[i];$("#"+id+"Id").val(document.id)}}$("#"+id).val(path)},failure:function(code,message){$("#"+id+"Id").val("");if(needLogin(data.code)){localStorage.removeItem("accessToken");localStorage.removeItem("account");localStorage.removeItem("key3");localStorage.removeItem("random");localStorage.removeItem("teacher");clear_data();window.top.location.href=getRootPath_dc()+"login.html"}}})}else{$upload(url,{targetType:config.targetType,purpose:config.purpose,targetId:null},{element:id,success:function(data){if(data.length>0){for(var i=0;i<data.length;++i){var document=data[i];image_show_div(document.id,id)}}},failure:function(code,message){$("#"+id+"Id").val("");if(needLogin(data.code)){localStorage.removeItem("accessToken");localStorage.removeItem("account");localStorage.removeItem("key3");localStorage.removeItem("random");localStorage.removeItem("teacher");clear_data();window.top.location.href=getRootPath_dc()+"login.html"}}})}}}}function image_show_div(imageId,inputId){setTimeout(function(){$("#"+inputId+"Id").val(imageId);$("#"+inputId+"Div").css("display","none");$("#"+inputId+"SuccessDiv").css("display","block");$("#"+inputId+"Img").attr("src",buildUpLoadImage(imageId))},"2000")}function uploadCertificateFile(id,config){var path=$("#"+id).val();if(!path){alert("请选择文件！");return}else{if(!validate_img(id)){return}var suffix=path.substring(path.lastIndexOf("."));var allowedSuffix=config.suffix||".JPG,.JPEG";if(allowedSuffix.indexOf(suffix.toUpperCase())<0){alert("请上传后缀为【"+allowedSuffix+"】的文件！");return}else{var url="rest/system/resource/doc/image/upload";$upload(url,{targetType:config.targetType,purpose:config.purpose,targetId:config.targetId,x:config.x,y:config.y,w:config.w,h:config.h},{element:id,success:function(data){if(config.success){config.success(data)}},failure:function(code,message){$("#"+id+"Id").val("");if(needLogin(data.code)){localStorage.removeItem("accessToken");localStorage.removeItem("account");localStorage.removeItem("key3");localStorage.removeItem("random");localStorage.removeItem("teacher");clear_data();window.top.location.href=getRootPath_dc()+"login.html"}show_code(url,code)}})}}}function $upload(url,data,config){var stamp=(new Date).getTime();var token=localStorage.accessToken;var signature=calcSignature(stamp);var api=getDomain_dc()+url;$.ajaxFileUpload({url:api,secureuri:false,fileElementId:config.element,dataType:"JSON",data:data,type:"post",headers:{Authorization:token,channel:_channel_id,stamp:stamp,signature:signature},success:function(data){if(data.code===0){config.success(data.data)}else{var showError=false;if(config.failure){config.failure(data.code,data.message)}else{showError=true}if(needLogin(data.code)){localStorage.removeItem("accessToken");localStorage.removeItem("account");localStorage.removeItem("key3");localStorage.removeItem("random");localStorage.removeItem("teacher");clear_data();window.top.location.href=getRootPath_dc()+"login.html"}if(showError){show_code(url,data.code)}}if(config.clear){config.clear()}}})}function callCaptcha(component,type,path,config){var url="rest/security/identify/captcha";var cfg=config;$get(url,null,{success:function(data){var cid=data.data.id;var offset_x=data.data.offsetX;var type=data.data.type;if(type=="default"){type=""}else{type=type+"_"}component.imgcode({frontimg:path+"captcha/"+type+data.data.index+"_27_thumb.png",backimg:path+"captcha/"+type+data.data.index+"_27_background.png",refreshcallback:function(){},callback:function(msg){var x=parseInt(msg.xpos-offset_x);var url="rest/security/identify/captcha/verify";$get(url,{id:cid,x:x},{success:function(data){if(cfg&&cfg.clear){cfg.clear()}},failure:function(){}})}})}})}function str2utf8(str){var code;var utf="";for(var i=0;i<str.length;i++){code=str.charCodeAt(i);if(code<128){utf+=str.charAt(i)}else if(code<2048){utf+=String.fromCharCode(192|code>>6&31);utf+=String.fromCharCode(128|code>>0&63)}else if(code<65536){utf+=String.fromCharCode(224|code>>12&15);utf+=String.fromCharCode(128|code>>6&63);utf+=String.fromCharCode(128|code>>0&63)}else{throw"不是UCS-2字符集"}}return utf}